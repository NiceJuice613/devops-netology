
# Домашнее задание к занятию "7.3.  Основы и принцип работы Terraform"

#### Задача 1. Создадим бэкэнд в S3 (необязательно, но крайне желательно).

1. Создайте s3 бакет, iam роль и пользователя от которого будет работать терраформ. Можно создать отдельного пользователя, а можно использовать созданного в рамках предыдущего задания, просто добавьте ему необходимы права, как описано [здесь](https://www.terraform.io/docs/backends/types/s3.html).
2. Зарегистрируйте бэкэнд в терраформ проекте как описано по ссылке выше.

![Screenshot_1](C:\Users\KING\Desktop\Screenshot_1.jpg)

Создал бакет в YC, на этапе инициализации Терраформ состояние не переносится в бакет, только при применении конфигурации.

#### Задача 2. Инициализируем проект и создаем воркспейсы.

1. Выполните terraform init :

   - если был создан бэкэнд в S3, то терраформ создаст файл стейтов в S3 и запись в таблице dynamodb.

   - иначе будет создан локальный файл со стейтами.

     ![Screenshot_2](C:\Users\KING\Desktop\Screenshot_2.jpg)

2. Создайте два воркспейса `stage` и `prod`.

   ![Screenshot_3](C:\Users\KING\Desktop\Screenshot_3.jpg)

   ![Screenshot_4](C:\Users\KING\Desktop\Screenshot_4.jpg)

3. В уже созданный `aws_instance` добавьте зависимость типа инстанса от вокспейса, что бы в разных ворскспейсах использовались разные `instance_type`.

4. Добавим `count`. Для `stage` должен создаться один экземпляр `ec2`, а для `prod` два.

5. Создайте рядом еще один `aws_instance`, но теперь определите их количество при помощи `for_each`, а не `count`.

6. Что бы при изменении типа инстанса не возникло ситуации, когда не будет ни одного инстанса добавьте параметр жизненного цикла `create_before_destroy = true` в один из ресурсов `aws_instance`

Проблема такая - после создания воркспейсов Терраформ их не видит, пишет что их нет. Команда terraform workspace list выдает только default. В бакете яндекс облака появились сейвы их состояний.

Не могу понять в чем дело, что сделано не так? Должны ли онповиться локально в директории чтобы с ними работать?
